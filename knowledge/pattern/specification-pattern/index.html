<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Moon Smile">
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Specification Pattern - Note Pro</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
	
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
	<script src="../../../js/somelib.js"></script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-36723568-3', 'mkdocs.org');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">Note Pro</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../..">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Daily Plans <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../daily-plans/plans-version-1.1/">Version 1</a>
</li>
                                    
<li >
    <a href="../../../daily-plans/plans-version-2/">Version 2</a>
</li>
                                    
<li >
    <a href="../../../daily-plans/plans-version-3/">Version 3</a>
</li>
                                    
<li >
    <a href="../../../daily-plans/plans-version-3.1/">Version 3.1</a>
</li>
                                    
<li >
    <a href="../../../daily-plans/soft-skills-for-learning/">Soft Skills for Learning</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">KnowLedge <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Principles</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../principles/s-o-l-i-d/">S.O.L.I.D</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Pattern</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../dependency-injection/">Dependency Injection</a>
</li>
            
<li >
    <a href="../design_pattern/">Design Pattern</a>
</li>
            
<li >
    <a href="../aggregate-pattern/">Aggregate Pattern</a>
</li>
            
<li >
    <a href="../the-7-most-important-software-design-patterns/">The 7 mose important software design pattern</a>
</li>
            
<li >
    <a href="../repository-pattern/">Repository Pattern</a>
</li>
            
<li class="active">
    <a href="./">Specification Pattern</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Algorithms</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../algorithms/analysis-of-algorithms/">Analysis of Algorithms</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Architectures</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../architectures/three-tier/">Three tier</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">DevOps</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Circle CI</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../dev-ops/circle-ci/writing-yaml/">Writing YAML</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Docker</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../dev-ops/docker/docker-network/">Docker Network</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Web Development</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Basics</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../web-development/basics/code-coverage/">Code Coverage</a>
</li>
            
<li >
    <a href="../../web-development/basics/regression-testing/">Regression Testing</a>
</li>
            
<li >
    <a href="../../web-development/basics/functional-testing/">Functional Testing</a>
</li>
            
<li >
    <a href="../../web-development/basics/integration-testing/">Integration Testing</a>
</li>
            
<li >
    <a href="../../web-development/basics/unit-testing/">Unit Testing</a>
</li>
            
<li >
    <a href="../../web-development/basics/css-handbook/">CSS HandBook</a>
</li>
            
<li >
    <a href="../../web-development/basics/introducing-websockets/">Introducing WebSockets</a>
</li>
            
<li >
    <a href="../../web-development/basics/graphql/">GraphQL</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">ASP.NET</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../web-development/asp.net/introduction/">Introduction</a>
</li>
            
<li >
    <a href="../../web-development/asp.net/nswag/">NSwag</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">NodeJS</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../web-development/nodejs/libuv/">Libuv</a>
</li>
            
<li >
    <a href="../../web-development/nodejs/overview-of-blocking-and-non-blocking/">Overview of Blocking and Non-Blocking</a>
</li>
            
<li >
    <a href="../../web-development/nodejs/what-is-the-event-loop/">The Node.js Event Loop</a>
</li>
            
<li >
    <a href="../../web-development/nodejs/get-started.md">Get Started</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Ruby On Rails</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../web-development/ruby-on-rails/overview.md">Overview</a>
</li>
            
<li >
    <a href="../../web-development/ruby-on-rails/rails-form-expand/">Rails Form Expand</a>
</li>
            
<li >
    <a href="../../web-development/ruby-on-rails/rails-active-record-callbacks/">Active Record Callbacks</a>
</li>
            
<li >
    <a href="../../web-development/ruby-on-rails/action-view-form-helpers.md">Action View Form Helpers</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Stories</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Skill Blog</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../stories/skill-blog/how-to-be-a-great-programmer/">How to be a great programmer</a>
</li>
            
<li >
    <a href="../../stories/skill-blog/what-javascript-developers-learn-from-c++/">What Javascript Developers can learn from C++</a>
</li>
            
<li >
    <a href="../../stories/skill-blog/what-i-learn-from-lauching-a-freelance-writing-bussiess.md">What I learn from lauching a freelance writing business</a>
</li>
            
<li >
    <a href="../../stories/skill-blog/how-code-reviews-work-at-microsoft/">How code reviews work at Microsoft</a>
</li>
            
<li >
    <a href="../../stories/skill-blog/how-to-debug-with-firefox/">How to debug web apps with Firefox developer tools</a>
</li>
            
<li >
    <a href="../../stories/skill-blog/beyond-coding-soft-skill-to-avoid-projects-fails/">Beyond Coding - Soft skill to avoid projects failures</a>
</li>
            
<li >
    <a href="../../stories/skill-blog/3-things-to-do-when-you-dont-have-computers-science-degree/">3 Things to do when you don't have computer science degree</a>
</li>
            
<li >
    <a href="../../stories/skill-blog/net-core-is-future-of-net/">.NET Core is Future of .NET</a>
</li>
            
<li >
    <a href="../../stories/skill-blog/introducing-net-5/">Introducing .NET 5</a>
</li>
            
<li >
    <a href="../../stories/skill-blog/scraping-the-web-with-nodejs/">Scraping Web With Nodejs</a>
</li>
            
<li >
    <a href="../../stories/skill-blog/roadmap-web-developer-2019/">Roadmap Web Developer 2019</a>
</li>
            
<li >
    <a href="../../stories/skill-blog/tinygo/">Tiny Go</a>
</li>
            
<li >
    <a href="../../stories/skill-blog/net-stacks/">.NET stacks</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Dev Ops</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../stories/devops-blog/what-is-devops-and-why-do-we-need-it/">What is DevOps? Why do we need it?</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Computer Science</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../stories/computer-science/what-is-different-between-machine-learning-and-ai/">What is between machine learning and AI</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Blockchain</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../stories/blockchain-blog/matic-developer-support-program/">Matic Developer Support Program</a>
</li>
            
<li >
    <a href="../../stories/blockchain-blog/what-is-matic-network/">What Is Matic Network</a>
</li>
            
<li >
    <a href="../../stories/blockchain-blog/plasma/">Plasma</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Thinking In Art</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../stories/thinking-in-art/you-could-have-today-instead-you-choose-tomorrow/">You Could Have Today Intead You Choose Tomorrow</a>
</li>
            
<li >
    <a href="../../stories/thinking-in-art/how-to-quit-your-job-and-live-your-startup-dream/">How to quit your job and live your startup dream</a>
</li>
            
<li >
    <a href="../../stories/thinking-in-art/how-two-words-can-change-your-life/">How two words can change your life</a>
</li>
            
<li >
    <a href="../../stories/thinking-in-art/4-practical-things-i-do-to-stay-positive/">4 Practical Things I do to stay positive</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Xamarin Blog</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../stories/xamarin-blog/getting-started-workmanager/">Getting Started WorkManager</a>
</li>
            
<li >
    <a href="../../stories/xamarin-blog/sharing-files-and-email-attachments/">Sharing Files and Email Attachment</a>
</li>
            
<li >
    <a href="../../stories/xamarin-blog/add-a-backend-to-your-app-in-10-minutes/">Add a Backend to Your App in 10 minutes</a>
</li>
            
<li >
    <a href="../../stories/xamarin-blog/behavior-xamarin/">Behavior In Xamarin Forms</a>
</li>
            
<li >
    <a href="../../stories/xamarin-blog/shrinking-your-android-app-size/">Shrinking Your Android App Size</a>
</li>
            
<li >
    <a href="../../stories/xamarin-blog/mobile-tools-for-designers/">Mobile Tools for Designer</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Mobile Development</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../mobile-development/overview/">Overview</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Xamarin</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../mobile-development/xamarin/xamarin-forms-shell/">Xamarin Forms Shell</a>
</li>
            
<li >
    <a href="../../mobile-development/xamarin/controls-reference/">Controls Reference</a>
</li>
            
<li >
    <a href="../../mobile-development/xamarin/customizing-listview-cell-appearance/">Customizing ListView cell Appearence</a>
</li>
            
<li >
    <a href="../../mobile-development/xamarin/data-pages/">Data Pages</a>
</li>
            
<li >
    <a href="../../mobile-development/xamarin/data-pages-controls/">Data Pages Controls</a>
</li>
            
<li >
    <a href="../../mobile-development/xamarin/triggers/">Triggers</a>
</li>
            
<li >
    <a href="../../mobile-development/xamarin/xamarin-forms-theme/">Themes</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Template</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../mobile-development/xamarin/templates/overview/">Overview</a>
</li>
            
<li >
    <a href="../../mobile-development/xamarin/templates/control-templates/">Control Templates</a>
</li>
            
<li >
    <a href="../../mobile-development/xamarin/templates/data-templates/">Data Templates</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../repository-pattern/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../../algorithms/analysis-of-algorithms/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/MoonSmile1707/NotePro/blob/master/docs/knowledge/pattern/specification-pattern.md"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#specification-pattern">Specification Pattern</a></li>
            <li><a href="#generic-specification-interface">Generic Specification Interface</a></li>
            <li><a href="#generic-specification-implementation-base-class">Generic Specification Implementation (Base Class)</a></li>
            <li><a href="#a-simple-specification">A Simple Specification</a></li>
            <li><a href="#generic-ef-repository-with-specification">Generic EF Repository with Specification</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="specification-pattern">Specification Pattern</h1>
<hr/>

<p>One Domain-Deriven-Design solution to the problem of where to place querying, sorting, and paging logic is to use a <em>Specification</em>. The Specification design pattern describes a query in an object. So to encapsulate a paged query that searches for some products, one might create a PagedProduct specification which would take in any necessary parameters (PageSize, pageNumber, filter). Then one of your repository methods (usually a List() overload) would accept an ISpecification and would be able to produce the expected result given the specification. There are several benefits to this approach. The spcification has a name (as opposed to just a bunch of LINQ expressions) that you can reason about and discuss. It can be unit tested in isolution to ensure correctness. And it can easily be resued if you need the same behavior (say on a MVC View action and a Web API action, as well as in varyous services). Further, a specificaition can also be used to describe the shape of the data to be returned, so that queries can return just the data they required. This eliminates the need for lazy loading in web applicaiton and help keep repository implementations from becoming clutteredwith these details.</p>
<h2 id="generic-specification-interface">Generic Specification Interface</h2>
<pre><code class="csharp">// https://github.com/dotnet-architecture/eShopOnWeb
public interface ISpecification&lt;T&gt;
{
    Expression&lt;Func&lt;T, bool&gt;&gt; Criteria { get; }
    List&lt;Expression&lt;Func&lt;T, object&gt;&gt;&gt; Includes { get; }
    List&lt;string&gt; IncludeStrings { get; }
}
</code></pre>

<h2 id="generic-specification-implementation-base-class">Generic Specification Implementation (Base Class)</h2>
<pre><code class="csharp">// https://github.com/dotnet-architecture/eShopOnWeb
public abstract class BaseSpecification&lt;T&gt; : ISpecification&lt;T&gt;
{
    public BaseSpecification(Expression&lt;Func&lt;T, bool&gt;&gt; criteria)
    {
        Criteria = criteria;
    }
    public Expression&lt;Func&lt;T, bool&gt;&gt; Criteria { get; }
    public List&lt;Expression&lt;Func&lt;T, object&gt;&gt;&gt; Includes { get; } = new List&lt;Expression&lt;Func&lt;T, object&gt;&gt;&gt;();
    public List&lt;string&gt; IncludeStrings { get; } = new List&lt;string&gt;();

    protected virtual void AddInclude(Expression&lt;Func&lt;T, object&gt;&gt; includeExpression)
    {
        Includes.Add(includeExpression);
    }
    // string-based includes allow for including children of children, e.g. Basket.Items.Product
    protected virtual void AddInclude(string includeString)
    {
        IncludeStrings.Add(includeString);
    }
}
</code></pre>

<h2 id="a-simple-specification">A Simple Specification</h2>
<p>The following specification will load a signle basket entity given either the basket's ID or the ID of the buyer to whom the basket belogs. It will eager load the basket's Items collection.</p>
<pre><code class="csharp">public class BasketWithItemsSpecification : BaseSpecification&lt;Basket&gt;
{
    public BasketWithItemsSpecification(int basketId)
        : base(b =&gt; b.Id == basketId)
    {
        AddInclude(b =&gt; b.Items);
    }
    public BasketWithItemsSpecification(string buyerId)
        : base(b =&gt; b.BuyerId == buyerId)
    {
        AddInclude(b =&gt; b.Items);
    }
}
</code></pre>

<h2 id="generic-ef-repository-with-specification">Generic EF Repository with Specification</h2>
<pre><code class="csharp">// https://github.com/dotnet-architecture/eShopOnWeb
public IEnumerable&lt;T&gt; List(ISpecification&lt;T&gt; spec)
{
    // fetch a Queryable that includes all expression-based includes
    var queryableResultWithIncludes = spec.Includes
        .Aggregate(_dbContext.Set&lt;T&gt;().AsQueryable(),
            (current, include) =&gt; current.Include(include));

    // modify the IQueryable to include any string-based include statements
    var secondaryResult = spec.IncludeStrings
        .Aggregate(queryableResultWithIncludes,
            (current, include) =&gt; current.Include(include));

    // return the result of the query using the specification's criteria expression
    return secondaryResult
                    .Where(spec.Criteria)
                    .AsEnumerable();
}
</code></pre>

<p>Although it's not recommended to return IQueryable from a repository, it's perfectly fine to use them within the repository to build up a set of results. You can see this approach used in the List method above, which uses intermediate IQueryable expressions to build up the query's list of includes before executing the query with the specification's criteria on the last line.</p>
<hr/>

<p>Get more information at <a href="https://deviq.com/specification-pattern/">here</a>.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Moon Smile 2019</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
